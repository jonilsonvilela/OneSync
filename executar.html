<!-- templates/executar.html -->
{% extends 'base.html' %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6">ðŸš€ Executando AtualizaÃ§Ã£o</h1>

<div class="flex items-center space-x-4 mb-4">
  <svg class="animate-spin h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
  </svg>
  <span class="text-indigo-700 font-medium">Aguarde... script em execuÃ§Ã£o</span>
</div>

<!-- Painel de log -->
<div class="bg-black text-green-400 p-4 rounded-lg h-[60vh] overflow-auto text-sm font-mono shadow" id="log">
  <p>Iniciando log ao vivo...</p>
</div>

<!-- BotÃµes finais (visÃ­veis apÃ³s fim da execuÃ§Ã£o) -->
<div id="botoes-finais" class="mt-6 hidden">
  <a href="{{ url_for('index') }}" class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800 transition">
    ðŸ”™ Voltar ao Dashboard
  </a>
  <a href="{{ url_for('resultado') }}" class="ml-4 bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 transition">
    ðŸ“„ Ver Ãšltimo Resultado
  </a>
</div>

<!-- Script de atualizaÃ§Ã£o via SSE -->
<script>
  const logDiv = document.getElementById('log');
  const botoesFinais = document.getElementById('botoes-finais');
  const eventSource = new EventSource('/stream');

  eventSource.onmessage = function(event) {
    if (!event.data) return;

    const novaLinha = document.createElement('div');
    novaLinha.textContent = event.data;
    logDiv.appendChild(novaLinha);
    logDiv.scrollTop = logDiv.scrollHeight;
  };

  eventSource.onerror = function() {
    eventSource.close();

    const fim = document.createElement('div');
    fim.textContent = 'âœ… ExecuÃ§Ã£o finalizada.';
    fim.classList.add('text-yellow-400', 'mt-4');
    logDiv.appendChild(fim);

    botoesFinais.classList.remove('hidden');
  };
</script>
{% endblock %}
