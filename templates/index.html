<!-- templates/index.html -->
{% extends 'base.html' %}

{% block content %}
<h1 class="text-2xl font-semibold mb-6">📂 Atualização de Processos</h1>

<!-- Formulário de upload com dropzone -->
<form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data"
      class="bg-white p-6 rounded-lg shadow-md space-y-6"
      x-data="{
        filename: '',
        dragover: false,
        validate(file) {
          if (!file.name.endsWith('.xlsx')) {
            alert('Apenas arquivos .xlsx são aceitos.');
            return false;
          }
          this.filename = file.name;
          return true;
        },
        drop(e) {
          e.preventDefault();
          this.dragover = false;
          const file = e.dataTransfer.files[0];
          if (this.validate(file)) {
            $refs.fileInput.files = e.dataTransfer.files;
          }
        }
      }"
      @dragover.prevent="dragover = true"
      @dragleave.prevent="dragover = false"
      @drop="drop($event)"
>

  <div class="border-2 border-dashed p-6 rounded-lg text-center transition-all duration-200"
       :class="dragover ? 'border-indigo-600 bg-indigo-50' : 'border-gray-300'">
    <p class="text-sm mb-2">Arraste o arquivo .xlsx aqui ou clique abaixo para selecionar</p>
    <input type="file" name="arquivo" accept=".xlsx" required
           class="block mx-auto text-sm"
           x-ref="fileInput"
           @change="filename = $refs.fileInput.files[0]?.name || ''"
    />
    <template x-if="filename">
      <p class="mt-2 text-sm text-green-600">📎 <strong x-text="filename"></strong> selecionado.</p>
    </template>
  </div>

  <div class="flex justify-between items-center">
    <button type="submit"
            class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
      Enviar Arquivo
    </button>

    <a href="{{ url_for('executar_stream') }}"
       class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">
      ▶️ Executar Atualização
    </a>
  </div>
</form>
{% endblock %}
